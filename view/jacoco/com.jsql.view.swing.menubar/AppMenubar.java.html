<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang=""><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>AppMenubar.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">view</a> &gt; <a href="index.source.html" class="el_package">com.jsql.view.swing.menubar</a> &gt; <span class="el_source">AppMenubar.java</span></div><h1>AppMenubar.java</h1><pre class="source lang-java linenums">/*******************************************************************************
 * Copyhacked (H) 2012-2025.
 * This program and the accompanying materials
 * are made available under no term at all, use it like
 * you want, but share and discuss it
 * every time possible with every body.
 * 
 * Contributors:
 *      ron190 at ymail dot com - initial implementation
 ******************************************************************************/
package com.jsql.view.swing.menubar;

import com.jsql.util.GitUtil.ShowOnConsole;
import com.jsql.util.I18nUtil;
import com.jsql.util.LogLevelUtil;
import com.jsql.view.swing.action.ActionSaveTab;
import com.jsql.view.swing.action.HotkeyUtil;
import com.jsql.view.swing.console.JTextPaneAppender;
import com.jsql.view.swing.dialog.DialogAbout;
import com.jsql.view.swing.dialog.DialogTranslate;
import com.jsql.view.swing.dialog.translate.Language;
import com.jsql.view.swing.panel.preferences.PanelExploit;
import com.jsql.view.swing.panel.preferences.PanelTampering;
import com.jsql.view.swing.sql.SqlEngine;
import com.jsql.view.swing.table.PanelTable;
import com.jsql.view.swing.text.JPopupTextArea;
import com.jsql.view.swing.text.JToolTipI18n;
import com.jsql.view.swing.util.I18nViewUtil;
import com.jsql.view.swing.util.MediatorHelper;
import com.jsql.view.swing.util.ModelSvgIcon;
import com.jsql.view.swing.util.UiUtil;
import org.apache.commons.lang3.StringUtils;
import org.apache.logging.log4j.LogManager;
import org.apache.logging.log4j.Logger;

import javax.swing.*;
import javax.swing.table.JTableHeader;
import javax.swing.table.TableColumnModel;
import javax.swing.text.JTextComponent;
import javax.swing.text.StyleConstants;
import java.awt.*;
import java.awt.event.InputEvent;
import java.awt.event.KeyEvent;
import java.awt.event.MouseAdapter;
import java.awt.event.MouseEvent;
import java.util.Arrays;
import java.util.List;
import java.util.Locale;
import java.util.stream.Stream;

/**
 * Application main menubar.
 */
public class AppMenubar extends JMenuBar {

<span class="fc" id="L56">    private static final Logger LOGGER = LogManager.getRootLogger();</span>

    public static final String MENU_COMMUNITY = &quot;menuCommunity&quot;;
    public static final String MENU_I18N_CONTRIBUTION = &quot;menuI18nContribution&quot;;
    public static final String ITEM_INTO_FRENCH = &quot;itemIntoFrench&quot;;
    public static final String MENU_HELP = &quot;menuHelp&quot;;
    public static final String ITEM_HELP = &quot;itemHelp&quot;;

    private final MenuWindows menuWindows;

<span class="fc" id="L66">    protected static final List&lt;ModelItemTranslate&gt; ITEMS_TRANSLATE = Stream.of(</span>
        Language.EN, Language.FR, Language.ES, Language.IT, Language.AR, Language.ZH, Language.RU, Language.TR, Language.KO,
        Language.SE, Language.FI, Language.CS, Language.PT, Language.PL, Language.ID, Language.NL, Language.RO, Language.DE
<span class="fc" id="L69">    ).map(ModelItemTranslate::new).toList();</span>

<span class="fc" id="L71">    private static final List&lt;ModelItemTranslate&gt; ITEMS_TRANSLATE_INTO = Stream.of(</span>
        Language.FR, Language.ES, Language.SE, Language.FI, Language.TR, Language.CS, Language.RO, Language.IT, Language.PT, Language.AR,
        Language.PL, Language.RU, Language.ZH, Language.DE, Language.ID, Language.JA, Language.KO, Language.HI, Language.NL, Language.TA
<span class="fc" id="L74">    ).map(ModelItemTranslate::new).toList();</span>

    /**
     * Create a menubar on main frame.
     */
<span class="fc" id="L79">    public AppMenubar() {</span>
<span class="fc" id="L80">        this.add(this.initMenuFile());</span>
<span class="fc" id="L81">        this.add(this.initMenuEdit());</span>
<span class="fc" id="L82">        this.add(this.initMenuCommunity());</span>
<span class="fc" id="L83">        this.menuWindows = new MenuWindows(this);</span>
<span class="fc" id="L84">        this.add(this.menuWindows);</span>
<span class="fc" id="L85">        this.add(this.initMenuHelp());</span>
<span class="fc" id="L86">    }</span>

    private JMenu initMenuFile() {
<span class="fc" id="L89">        var menuFile = new JMenu(I18nUtil.valueByKey(&quot;MENUBAR_FILE&quot;));</span>
<span class="fc" id="L90">        I18nViewUtil.addComponentForKey(&quot;MENUBAR_FILE&quot;, menuFile);</span>
<span class="fc" id="L91">        menuFile.setMnemonic('F');</span>

<span class="fc" id="L93">        JMenuItem itemSave = new JMenuItem(new ActionSaveTab());</span>
<span class="fc" id="L94">        I18nViewUtil.addComponentForKey(&quot;MENUBAR_FILE_SAVETABAS&quot;, itemSave);</span>

<span class="fc" id="L96">        JMenuItem itemExit = new JMenuItem(I18nUtil.valueByKey(&quot;MENUBAR_FILE_EXIT&quot;), 'x');</span>
<span class="fc" id="L97">        I18nViewUtil.addComponentForKey(&quot;MENUBAR_FILE_EXIT&quot;, itemExit);</span>
<span class="pc" id="L98">        itemExit.addActionListener(actionEvent -&gt; MediatorHelper.frame().dispose());</span>

<span class="fc" id="L100">        HotkeyUtil.addShortcut(this);</span>

<span class="fc" id="L102">        menuFile.add(itemSave);</span>
<span class="fc" id="L103">        menuFile.add(new JSeparator());</span>
<span class="fc" id="L104">        menuFile.add(itemExit);</span>
<span class="fc" id="L105">        return menuFile;</span>
    }

    private JMenu initMenuEdit() {
<span class="fc" id="L109">        var menuEdit = new JMenu(I18nUtil.valueByKey(&quot;MENUBAR_EDIT&quot;));</span>
<span class="fc" id="L110">        I18nViewUtil.addComponentForKey(&quot;MENUBAR_EDIT&quot;, menuEdit);</span>
<span class="fc" id="L111">        menuEdit.setMnemonic('E');</span>

<span class="fc" id="L113">        JMenuItem itemCopy = new JMenuItem(I18nUtil.valueByKey(&quot;CONTEXT_MENU_COPY&quot;), 'C');</span>
<span class="fc" id="L114">        I18nViewUtil.addComponentForKey(&quot;CONTEXT_MENU_COPY&quot;, itemCopy);</span>
<span class="fc" id="L115">        itemCopy.setAccelerator(KeyStroke.getKeyStroke(KeyEvent.VK_C, InputEvent.CTRL_DOWN_MASK));</span>
<span class="fc" id="L116">        itemCopy.addActionListener(actionEvent -&gt; {</span>
<span class="nc bnc" id="L117" title="All 2 branches missed.">            if (MediatorHelper.tabResults().getSelectedComponent() instanceof PanelTable panelTable) {</span>
<span class="nc" id="L118">                panelTable.copyTable();</span>
<span class="nc bnc" id="L119" title="All 2 branches missed.">            } else if (MediatorHelper.tabResults().getSelectedComponent() instanceof JScrollPane jScrollPane) {</span>
<span class="nc" id="L120">                ((JTextComponent) jScrollPane.getViewport().getView()).copy();</span>
            }
<span class="nc" id="L122">        });</span>

<span class="fc" id="L124">        JMenuItem itemSelectAll = new JMenuItem(I18nUtil.valueByKey(&quot;CONTEXT_MENU_SELECT_ALL&quot;), 'A');</span>
<span class="fc" id="L125">        I18nViewUtil.addComponentForKey(&quot;CONTEXT_MENU_SELECT_ALL&quot;, itemSelectAll);</span>
<span class="fc" id="L126">        itemSelectAll.setAccelerator(KeyStroke.getKeyStroke(KeyEvent.VK_A, InputEvent.CTRL_DOWN_MASK));</span>
<span class="fc" id="L127">        itemSelectAll.addActionListener(actionEvent -&gt; {</span>
<span class="nc bnc" id="L128" title="All 2 branches missed.">            if (MediatorHelper.tabResults().getSelectedComponent() instanceof PanelTable panelTable) {</span>
<span class="nc" id="L129">                panelTable.selectTable();</span>
<span class="nc bnc" id="L130" title="All 2 branches missed.">            } else if (MediatorHelper.tabResults().getSelectedComponent() instanceof JScrollPane jScrollPane) {</span>
                // Textarea need focus to select all
<span class="nc" id="L132">                jScrollPane.getViewport().getView().requestFocusInWindow();</span>
<span class="nc" id="L133">                ((JTextComponent) jScrollPane.getViewport().getView()).selectAll();</span>
            }
<span class="nc" id="L135">        });</span>

<span class="fc" id="L137">        menuEdit.add(itemCopy);</span>
<span class="fc" id="L138">        menuEdit.add(new JSeparator());</span>
<span class="fc" id="L139">        menuEdit.add(itemSelectAll);</span>
<span class="fc" id="L140">        return menuEdit;</span>
    }

    private JMenu initMenuCommunity() {
<span class="fc" id="L144">        var menuCommunity = new JMenu(I18nUtil.valueByKey(&quot;MENUBAR_COMMUNITY&quot;));</span>
<span class="fc" id="L145">        menuCommunity.setMnemonic('C');</span>
<span class="fc" id="L146">        menuCommunity.setName(AppMenubar.MENU_COMMUNITY);</span>
<span class="fc" id="L147">        I18nViewUtil.addComponentForKey(&quot;MENUBAR_COMMUNITY&quot;, menuCommunity);</span>

<span class="fc" id="L149">        JMenu menuI18nContribution = this.initMenuI18nContribution();</span>
<span class="fc" id="L150">        menuI18nContribution.setName(AppMenubar.MENU_I18N_CONTRIBUTION);</span>

<span class="fc" id="L152">        JMenuItem itemReportIssue = this.initItemReportIssue();</span>
<span class="fc" id="L153">        itemReportIssue.setName(&quot;itemReportIssue&quot;);</span>

<span class="fc" id="L155">        menuCommunity.add(menuI18nContribution);</span>
<span class="fc" id="L156">        menuCommunity.add(new JSeparator());</span>
<span class="fc" id="L157">        menuCommunity.add(itemReportIssue);</span>
<span class="fc" id="L158">        return menuCommunity;</span>
    }

    private JMenu initMenuI18nContribution() {
<span class="fc" id="L162">        var menuI18nContribution = new JMenu(I18nUtil.valueByKey(&quot;MENUBAR_COMMUNITY_HELPTRANSLATE&quot;));</span>
<span class="fc" id="L163">        I18nViewUtil.addComponentForKey(&quot;MENUBAR_COMMUNITY_HELPTRANSLATE&quot;, menuI18nContribution);</span>

<span class="fc" id="L165">        final var dialogTranslate = new DialogTranslate();  // Render the About dialog behind the scene</span>
<span class="fc" id="L166">        AppMenubar.ITEMS_TRANSLATE_INTO.forEach(model -&gt; {</span>
<span class="fc" id="L167">            model.setMenuItem(new JMenuItem(model.getLanguage().getMenuItemLabel(), model.getLanguage().getFlag()));</span>
<span class="fc" id="L168">            model.getMenuItem().addActionListener(new ActionTranslate(dialogTranslate, model.getLanguage()));</span>
<span class="fc" id="L169">            menuI18nContribution.add(model.getMenuItem());</span>
<span class="fc" id="L170">        });</span>

<span class="fc" id="L172">        var itemIntoOther = new JMenuItem(I18nUtil.valueByKey(&quot;MENUBAR_COMMUNITY_ANOTHERLANGUAGE&quot;));</span>
<span class="fc" id="L173">        I18nViewUtil.addComponentForKey(&quot;MENUBAR_COMMUNITY_ANOTHERLANGUAGE&quot;, itemIntoOther);</span>

<span class="fc bfc" id="L175" title="All 2 branches covered.">        AppMenubar.ITEMS_TRANSLATE_INTO.stream().filter(model -&gt; model.getLanguage() == Language.AR)</span>
<span class="fc" id="L176">        .forEach(modelItemTranslate -&gt; modelItemTranslate.getMenuItem().setComponentOrientation(ComponentOrientation.RIGHT_TO_LEFT));</span>
<span class="fc bfc" id="L177" title="All 2 branches covered.">        AppMenubar.ITEMS_TRANSLATE_INTO.stream().filter(model -&gt; model.getLanguage() == Language.FR)</span>
<span class="fc" id="L178">        .forEach(modelItemTranslate -&gt; modelItemTranslate.getMenuItem().setName(AppMenubar.ITEM_INTO_FRENCH));</span>

<span class="fc" id="L180">        menuI18nContribution.add(new JSeparator());</span>
<span class="fc" id="L181">        menuI18nContribution.add(itemIntoOther);</span>
<span class="fc" id="L182">        itemIntoOther.addActionListener(new ActionTranslate(dialogTranslate, Language.OT));</span>

<span class="fc" id="L184">        return menuI18nContribution;</span>
    }

    private JMenuItem initItemReportIssue() {
<span class="fc" id="L188">        JMenuItem itemReportIssue = new JMenuItem(I18nUtil.valueByKey(&quot;MENUBAR_COMMUNITY_REPORTISSUE&quot;), 'R');</span>
<span class="fc" id="L189">        I18nViewUtil.addComponentForKey(&quot;MENUBAR_COMMUNITY_REPORTISSUE&quot;, itemReportIssue);</span>

<span class="fc" id="L191">        String reportBody = &quot;&quot;&quot;</span>
            ## What's the expected behavior?
            
            ## What's the actual behavior?
            
            ## Any other detailed information on the Issue?
            
            ## Steps to reproduce the problem
            
              1. ...
              2. ...
            
            ## [Community] Request for new feature
            
            &quot;&quot;&quot;;
<span class="fc" id="L206">        itemReportIssue.addActionListener(actionEvent -&gt; {</span>
<span class="fc" id="L207">            var panel = new JPanel(new BorderLayout());</span>
<span class="fc" id="L208">            final JTextArea textarea = new JPopupTextArea(new JTextArea()).getProxy();</span>
<span class="fc" id="L209">            textarea.setFont(new Font(</span>
                UiUtil.FONT_NAME_MONOSPACED,
                Font.PLAIN,
<span class="fc" id="L212">                UIManager.getDefaults().getFont(&quot;TextField.font&quot;).getSize()</span>
            ));
<span class="fc" id="L214">            textarea.setText(reportBody);</span>
<span class="fc" id="L215">            panel.add(new JLabel(&quot;Describe your bug or issue:&quot;), BorderLayout.NORTH);</span>
<span class="fc" id="L216">            panel.add(new JScrollPane(textarea));</span>
<span class="fc" id="L217">            panel.setPreferredSize(new Dimension(500, 350));</span>
<span class="fc" id="L218">            panel.setMinimumSize(new Dimension(500, 350));</span>

<span class="fc" id="L220">            textarea.addMouseListener(new MouseAdapter() {</span>
                @Override
                public void mousePressed(MouseEvent e) {
<span class="nc" id="L223">                    super.mousePressed(e);</span>
<span class="nc" id="L224">                    textarea.requestFocusInWindow();</span>
<span class="nc" id="L225">                }</span>
            });

<span class="fc" id="L228">            int result = JOptionPane.showOptionDialog(</span>
<span class="fc" id="L229">                MediatorHelper.frame(),</span>
                panel,
                &quot;Report an issue or a bug&quot;,
                JOptionPane.OK_CANCEL_OPTION,
                JOptionPane.QUESTION_MESSAGE,
                null,
                new String[] {
                    &quot;Send&quot;,
<span class="fc" id="L237">                    I18nUtil.valueByKey(&quot;LIST_ADD_VALUE_CANCEL&quot;)</span>
                },
<span class="fc" id="L239">                I18nUtil.valueByKey(&quot;LIST_ADD_VALUE_CANCEL&quot;)</span>
            );

<span class="pc bpc" id="L242" title="2 of 4 branches missed.">            if (StringUtils.isNotEmpty(textarea.getText()) &amp;&amp; result == JOptionPane.YES_OPTION) {</span>
<span class="nc" id="L243">                MediatorHelper.model().getMediatorUtils().gitUtil().sendReport(textarea.getText(), ShowOnConsole.YES, &quot;Report&quot;);</span>
            }
<span class="fc" id="L245">        });</span>

<span class="fc" id="L247">        return itemReportIssue;</span>
    }

    private JMenu initMenuHelp() {
<span class="fc" id="L251">        var menuHelp = new JMenu(I18nUtil.valueByKey(&quot;MENUBAR_HELP&quot;));</span>
<span class="fc" id="L252">        menuHelp.setMnemonic('H');</span>
<span class="fc" id="L253">        I18nViewUtil.addComponentForKey(&quot;MENUBAR_HELP&quot;, menuHelp);</span>
<span class="fc" id="L254">        menuHelp.setName(AppMenubar.MENU_HELP);</span>

<span class="fc" id="L256">        JMenuItem itemHelp = new JMenuItem(I18nUtil.valueByKey(&quot;MENUBAR_HELP_ABOUT&quot;), 'A');</span>
<span class="fc" id="L257">        I18nViewUtil.addComponentForKey(&quot;MENUBAR_HELP_ABOUT&quot;, itemHelp);</span>
<span class="fc" id="L258">        itemHelp.setName(AppMenubar.ITEM_HELP);</span>

<span class="fc" id="L260">        JMenuItem itemUpdate = new JMenuItem(I18nUtil.valueByKey(&quot;MENUBAR_HELP_UPDATE&quot;), 'U');</span>
<span class="fc" id="L261">        I18nViewUtil.addComponentForKey(&quot;MENUBAR_HELP_UPDATE&quot;, itemUpdate);</span>

        // Render the About dialog behind the scene
<span class="fc" id="L264">        itemHelp.addActionListener(actionEvent -&gt; {</span>
<span class="fc" id="L265">            final var dialogAbout = new DialogAbout();</span>
<span class="pc bpc" id="L266" title="1 of 2 branches missed.">            if (!dialogAbout.isVisible()) {</span>
<span class="fc" id="L267">                dialogAbout.initDialog();</span>
<span class="fc" id="L268">                dialogAbout.setVisible(true);  // needed here for button focus</span>
<span class="fc" id="L269">                dialogAbout.requestButtonFocus();</span>
            }
<span class="fc" id="L271">            dialogAbout.setVisible(true);</span>
<span class="fc" id="L272">        });</span>
<span class="fc" id="L273">        itemUpdate.addActionListener(new ActionCheckUpdate());</span>

<span class="fc" id="L275">        menuHelp.add(itemUpdate);</span>
<span class="fc" id="L276">        menuHelp.add(new JSeparator());</span>
<span class="fc" id="L277">        menuHelp.add(itemHelp);</span>
<span class="fc" id="L278">        return menuHelp;</span>
    }

    public static void applyTheme(String nameTheme) {
<span class="fc" id="L282">        UiUtil.applyTheme(nameTheme);</span>

<span class="fc bfc" id="L284" title="All 2 branches covered.">        for (String key : I18nViewUtil.keys()) {</span>
<span class="fc bfc" id="L285" title="All 2 branches covered.">            for (Object component : I18nViewUtil.componentsByKey(key)) {</span>
<span class="fc bfc" id="L286" title="All 2 branches covered.">                if (component instanceof JToolTipI18n jToolTipI18n) {</span>
<span class="fc" id="L287">                    jToolTipI18n.updateUI();  // required</span>
                }
<span class="fc" id="L289">            }</span>
<span class="fc" id="L290">        }</span>

<span class="fc" id="L292">        Arrays.asList(</span>
            UiUtil.DATABASE_BOLD, UiUtil.ADMIN, UiUtil.DOWNLOAD, UiUtil.TERMINAL, UiUtil.UPLOAD, UiUtil.LOCK, UiUtil.TEXTFIELD, UiUtil.BATCH,
            UiUtil.TABLE_LINEAR, UiUtil.TABLE_BOLD, UiUtil.NETWORK, UiUtil.DATABASE_LINEAR, UiUtil.COG, UiUtil.CUP, UiUtil.CONSOLE, UiUtil.BINARY, UiUtil.CHUNK,
            UiUtil.ARROW, UiUtil.ARROW_HOVER, UiUtil.ARROW_PRESSED, UiUtil.ARROW_LEFT, UiUtil.ARROW_LEFT_HOVER, UiUtil.ARROW_LEFT_PRESSED,
            UiUtil.EXPAND, UiUtil.EXPAND_HOVER, UiUtil.EXPAND_PRESSED,
            UiUtil.HOURGLASS, UiUtil.ARROW_DOWN, UiUtil.ARROW_UP, UiUtil.SQUARE, UiUtil.GLOBE, UiUtil.TICK_GREEN, UiUtil.CROSS_RED,
            UiUtil.APP_ICON, UiUtil.APP_BIG, UiUtil.APP_MIDDLE
<span class="fc" id="L299">        ).forEach(ModelSvgIcon::setColorFilter);</span>

<span class="fc" id="L301">        SqlEngine.applyTheme();</span>
<span class="fc" id="L302">        PanelTampering.applyTheme();</span>
<span class="fc" id="L303">        PanelExploit.applyTheme();</span>
<span class="fc" id="L304">        MediatorHelper.panelConsoles().getTabbedPaneNetworkTab().applyTheme();</span>
<span class="fc" id="L305">        MediatorHelper.frame().setIconImages(UiUtil.getIcons());</span>
<span class="fc" id="L306">        MediatorHelper.frame().revalidate();</span>

<span class="fc" id="L308">        MediatorHelper.model().getMediatorUtils().preferencesUtil().withThemeFlatLafName(nameTheme).persist();</span>
<span class="fc" id="L309">    }</span>
    
    public void switchLocale(Locale newLocale) {
<span class="fc" id="L312">        Locale oldLocale = I18nUtil.getCurrentLocale();</span>
<span class="fc" id="L313">        I18nUtil.setCurrentBundle(newLocale);</span>

<span class="fc" id="L315">        Stream.of(</span>
            JTextPaneAppender.ATTRIBUTE_WARN,
            JTextPaneAppender.ATTRIBUTE_INFORM,
            JTextPaneAppender.ATTRIBUTE_SUCCESS,
            JTextPaneAppender.ATTRIBUTE_ALL
        )
<span class="fc" id="L321">        .forEach(attribute -&gt; {</span>
<span class="pc bpc" id="L322" title="1 of 2 branches missed.">            StyleConstants.setFontFamily(attribute, I18nViewUtil.isNonUbuntu(newLocale) ? UiUtil.FONT_NAME_MONO_ASIAN : UiUtil.FONT_NAME_MONO_NON_ASIAN);</span>
<span class="pc bpc" id="L323" title="1 of 2 branches missed.">            StyleConstants.setFontSize(attribute, I18nViewUtil.isNonUbuntu(newLocale) ? UiUtil.FONT_SIZE_MONO_ASIAN : UiUtil.FONT_SIZE_MONO_NON_ASIAN);</span>
<span class="fc" id="L324">        });</span>

<span class="pc bpc" id="L326" title="1 of 2 branches missed.">        MediatorHelper.managerBruteForce().getResult().setFont(I18nViewUtil.isNonUbuntu(newLocale) ? UiUtil.FONT_MONO_ASIAN : UiUtil.FONT_MONO_NON_ASIAN);</span>

<span class="fc" id="L328">        this.switchNetworkTable();</span>
<span class="fc" id="L329">        I18nViewUtil.switchI18nComponents();</span>
<span class="fc" id="L330">        this.switchOrientation(oldLocale, newLocale);</span>
<span class="fc" id="L331">        this.switchMenuItems();  // required to restore proper language orientation</span>
        
<span class="fc" id="L333">        MediatorHelper.treeDatabase().reloadNodes();</span>
<span class="fc" id="L334">        MediatorHelper.panelAddressBar().getPanelTrailingAddress().buttonStart.setIcons();</span>
<span class="pc bpc" id="L335" title="1 of 2 branches missed.">        int textPosition = ComponentOrientation.getOrientation(newLocale).isLeftToRight()  // leading/trailing not working</span>
<span class="fc" id="L336">            ? SwingConstants.LEFT</span>
<span class="pc" id="L337">            : SwingConstants.RIGHT;</span>
<span class="fc" id="L338">        MediatorHelper.panelAddressBar().getAtomicRadioRequest().setHorizontalTextPosition(textPosition);  // component orientation not working</span>
<span class="fc" id="L339">        MediatorHelper.panelAddressBar().getAtomicRadioMethod().setHorizontalTextPosition(textPosition);</span>
<span class="fc" id="L340">        MediatorHelper.panelAddressBar().getAtomicRadioHeader().setHorizontalTextPosition(textPosition);</span>

        // Fix #92981: IllegalArgumentException on revalidate()
        // Fix #96185: NullPointerException on revalidate()
        // Fix #96226: ArrayIndexOutOfBoundsException on revalidate()
        try {
<span class="fc" id="L346">            MediatorHelper.frame().revalidate();  // Fix glitches on Linux</span>
<span class="nc" id="L347">        } catch (NullPointerException | IllegalArgumentException | ArrayIndexOutOfBoundsException e) {</span>
<span class="nc" id="L348">            LOGGER.log(LogLevelUtil.CONSOLE_JAVA, e, e);</span>
<span class="fc" id="L349">        }</span>
<span class="fc" id="L350">    }</span>

    private void switchOrientation(Locale oldLocale, Locale newLocale) {
<span class="fc" id="L353">        var componentOrientation = ComponentOrientation.getOrientation(I18nUtil.getCurrentLocale());</span>
<span class="fc" id="L354">        MediatorHelper.frame().applyComponentOrientation(componentOrientation);</span>
        
<span class="pc bpc" id="L356" title="1 of 2 branches missed.">        if (!ComponentOrientation.getOrientation(oldLocale).equals(ComponentOrientation.getOrientation(newLocale))) {</span>
            // not rendered at startup, only on switch, unreliable components width can be 0 at startup
            // use event windowOpen instead when required
<span class="nc" id="L359">            AppMenubar.reverse(MediatorHelper.frame().getSplitNS().getSplitEW());</span>
<span class="nc" id="L360">            AppMenubar.reverse(MediatorHelper.panelConsoles().getNetworkSplitPane());</span>
        }
        
<span class="fc" id="L363">        MediatorHelper.tabResults().setComponentOrientation(ComponentOrientation.getOrientation(newLocale));</span>
<span class="fc" id="L364">    }</span>

    private static void reverse(JSplitPane splitPane) {
<span class="nc" id="L367">        var componentLeft = splitPane.getLeftComponent();</span>
<span class="nc" id="L368">        var componentRight = splitPane.getRightComponent();</span>

        // Reset components
<span class="nc" id="L371">        splitPane.setLeftComponent(null);</span>
<span class="nc" id="L372">        splitPane.setRightComponent(null);</span>
<span class="nc" id="L373">        splitPane.setLeftComponent(componentRight);</span>
<span class="nc" id="L374">        splitPane.setRightComponent(componentLeft);</span>

        // required as switch to arabic uses reversed location
<span class="nc" id="L377">        splitPane.setDividerLocation(splitPane.getWidth() - splitPane.getDividerLocation());</span>
<span class="nc" id="L378">    }</span>

    private void switchMenuItems() {
<span class="fc" id="L381">        Stream.concat(AppMenubar.ITEMS_TRANSLATE.stream(), AppMenubar.ITEMS_TRANSLATE_INTO.stream())</span>
<span class="fc" id="L382">        .forEach(model -&gt; model.getMenuItem().setComponentOrientation(</span>
<span class="fc bfc" id="L383" title="All 2 branches covered.">            model.getLanguage().isRightToLeft()</span>
<span class="fc" id="L384">            ? ComponentOrientation.RIGHT_TO_LEFT</span>
<span class="fc" id="L385">            : ComponentOrientation.LEFT_TO_RIGHT</span>
        ));
<span class="fc" id="L387">    }</span>

    private void switchNetworkTable() {
<span class="fc" id="L390">        JTableHeader header = MediatorHelper.panelConsoles().getNetworkTable().getTableHeader();</span>
<span class="fc" id="L391">        TableColumnModel columnModel = header.getColumnModel();</span>
<span class="fc" id="L392">        columnModel.getColumn(0).setHeaderValue(I18nUtil.valueByKey(&quot;NETWORK_TAB_URL_COLUMN&quot;));</span>
<span class="fc" id="L393">        columnModel.getColumn(1).setHeaderValue(I18nUtil.valueByKey(&quot;NETWORK_TAB_SIZE_COLUMN&quot;) +&quot; (KB)&quot;);</span>
<span class="fc" id="L394">        columnModel.getColumn(2).setHeaderValue(I18nUtil.valueByKey(&quot;SQLENGINE_STRATEGY&quot;));</span>
<span class="fc" id="L395">        columnModel.getColumn(3).setHeaderValue(I18nUtil.valueByKey(&quot;SQLENGINE_METADATA&quot;));</span>
<span class="fc" id="L396">        header.repaint();</span>
<span class="fc" id="L397">    }</span>
    
    
    // Getter and setter

    public JMenu getMenuView() {
<span class="nc" id="L403">        return this.menuWindows.getMenuView();</span>
    }

    public MenuWindows getMenuWindows() {
<span class="fc" id="L407">        return this.menuWindows;</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.14.202510111229</span></div></body></html>