<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang=""><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>AppMenubar.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">view</a> &gt; <a href="index.source.html" class="el_package">com.jsql.view.swing.menubar</a> &gt; <span class="el_source">AppMenubar.java</span></div><h1>AppMenubar.java</h1><pre class="source lang-java linenums">/*******************************************************************************
 * Copyhacked (H) 2012-2025.
 * This program and the accompanying materials
 * are made available under no term at all, use it like
 * you want, but share and discuss it
 * every time possible with every body.
 * 
 * Contributors:
 *      ron190 at ymail dot com - initial implementation
 ******************************************************************************/
package com.jsql.view.swing.menubar;

import com.jsql.util.GitUtil.ShowOnConsole;
import com.jsql.util.I18nUtil;
import com.jsql.util.LogLevelUtil;
import com.jsql.view.swing.action.ActionSaveTab;
import com.jsql.view.swing.action.HotkeyUtil;
import com.jsql.view.swing.console.JTextPaneAppender;
import com.jsql.view.swing.dialog.DialogAbout;
import com.jsql.view.swing.dialog.DialogTranslate;
import com.jsql.view.swing.dialog.translate.Language;
import com.jsql.view.swing.manager.util.JButtonStateful;
import com.jsql.view.swing.panel.preferences.PanelTampering;
import com.jsql.view.swing.sql.SqlEngine;
import com.jsql.view.swing.table.PanelTable;
import com.jsql.view.swing.text.JPopupTextArea;
import com.jsql.view.swing.text.JTextFieldPlaceholder;
import com.jsql.view.swing.text.JToolTipI18n;
import com.jsql.view.swing.tree.model.NodeModelEmpty;
import com.jsql.view.swing.util.I18nViewUtil;
import com.jsql.view.swing.util.MediatorHelper;
import com.jsql.view.swing.util.SvgIcon;
import com.jsql.view.swing.util.UiUtil;
import org.apache.commons.lang3.StringUtils;
import org.apache.logging.log4j.LogManager;
import org.apache.logging.log4j.Logger;

import javax.swing.*;
import javax.swing.table.JTableHeader;
import javax.swing.table.TableColumnModel;
import javax.swing.text.JTextComponent;
import javax.swing.text.StyleConstants;
import java.awt.*;
import java.awt.event.InputEvent;
import java.awt.event.KeyEvent;
import java.awt.event.MouseAdapter;
import java.awt.event.MouseEvent;
import java.util.Arrays;
import java.util.List;
import java.util.Locale;
import java.util.ResourceBundle;
import java.util.stream.Collectors;
import java.util.stream.Stream;

/**
 * Application main menubar.
 */
public class AppMenubar extends JMenuBar {
    
    /**
     * Log4j logger sent to view.
     */
<span class="fc" id="L63">    private static final Logger LOGGER = LogManager.getRootLogger();</span>

    private final MenuWindows menuWindows;

<span class="fc" id="L67">    protected final List&lt;ModelItem&gt; modelsItem = Stream.of(</span>
        Language.EN, Language.RU, Language.ZH, Language.ES, Language.FR, Language.TR, Language.KO, Language.SE, Language.FI,
        Language.AR, Language.CS, Language.IT, Language.PT, Language.PL, Language.IN, Language.NL, Language.RO, Language.DE
<span class="fc" id="L70">    ).map(ModelItem::new).collect(Collectors.toList());</span>

<span class="fc" id="L72">    private final List&lt;ModelItem&gt; modelsItemInto = Stream.of(</span>
        Language.FR, Language.ES, Language.SE, Language.FI, Language.TR, Language.CS, Language.RO, Language.IT, Language.PT, Language.AR,
        Language.PL, Language.RU, Language.ZH, Language.DE, Language.IN, Language.JA, Language.KO, Language.HI, Language.NL, Language.TA
<span class="fc" id="L75">    ).map(ModelItem::new).collect(Collectors.toList());</span>

    /**
     * Create a menubar on main frame.
     */
<span class="fc" id="L80">    public AppMenubar() {</span>
<span class="fc" id="L81">        this.add(this.initializeMenuFile());</span>
<span class="fc" id="L82">        this.add(this.initializeMenuEdit());</span>
<span class="fc" id="L83">        this.add(this.initializeMenuCommunity());</span>
<span class="fc" id="L84">        this.menuWindows = new MenuWindows(this);</span>
<span class="fc" id="L85">        this.add(this.menuWindows);</span>
<span class="fc" id="L86">        this.add(this.initializeMenuHelp());</span>
<span class="fc" id="L87">    }</span>

    private JMenu initializeMenuFile() {
<span class="fc" id="L90">        var menuFile = new JMenu(I18nUtil.valueByKey(&quot;MENUBAR_FILE&quot;));</span>
<span class="fc" id="L91">        I18nViewUtil.addComponentForKey(&quot;MENUBAR_FILE&quot;, menuFile);</span>
<span class="fc" id="L92">        menuFile.setMnemonic('F');</span>

<span class="fc" id="L94">        JMenuItem itemSave = new JMenuItem(new ActionSaveTab());</span>
<span class="fc" id="L95">        I18nViewUtil.addComponentForKey(&quot;MENUBAR_FILE_SAVETABAS&quot;, itemSave);</span>

<span class="fc" id="L97">        JMenuItem itemExit = new JMenuItem(I18nUtil.valueByKey(&quot;MENUBAR_FILE_EXIT&quot;), 'x');</span>
<span class="fc" id="L98">        I18nViewUtil.addComponentForKey(&quot;MENUBAR_FILE_EXIT&quot;, itemExit);</span>
<span class="pc" id="L99">        itemExit.addActionListener(actionEvent -&gt; MediatorHelper.frame().dispose());</span>

<span class="fc" id="L101">        HotkeyUtil.addShortcut(AppMenubar.this);</span>

<span class="fc" id="L103">        menuFile.add(itemSave);</span>
<span class="fc" id="L104">        menuFile.add(new JSeparator());</span>
<span class="fc" id="L105">        menuFile.add(itemExit);</span>
<span class="fc" id="L106">        return menuFile;</span>
    }

    private JMenu initializeMenuEdit() {
<span class="fc" id="L110">        var menuEdit = new JMenu(I18nUtil.valueByKey(&quot;MENUBAR_EDIT&quot;));</span>
<span class="fc" id="L111">        I18nViewUtil.addComponentForKey(&quot;MENUBAR_EDIT&quot;, menuEdit);</span>
<span class="fc" id="L112">        menuEdit.setMnemonic('E');</span>

<span class="fc" id="L114">        JMenuItem itemCopy = new JMenuItem(I18nUtil.valueByKey(&quot;CONTEXT_MENU_COPY&quot;), 'C');</span>
<span class="fc" id="L115">        I18nViewUtil.addComponentForKey(&quot;CONTEXT_MENU_COPY&quot;, itemCopy);</span>
<span class="fc" id="L116">        itemCopy.setAccelerator(KeyStroke.getKeyStroke(KeyEvent.VK_C, InputEvent.CTRL_DOWN_MASK));</span>
<span class="fc" id="L117">        itemCopy.addActionListener(actionEvent -&gt; {</span>
<span class="nc bnc" id="L118" title="All 2 branches missed.">            if (MediatorHelper.tabResults().getSelectedComponent() instanceof PanelTable) {</span>
<span class="nc" id="L119">                ((PanelTable) MediatorHelper.tabResults().getSelectedComponent()).copyTable();</span>
<span class="nc bnc" id="L120" title="All 2 branches missed.">            } else if (MediatorHelper.tabResults().getSelectedComponent() instanceof JScrollPane) {</span>
<span class="nc" id="L121">                ((JTextArea) ((JScrollPane) MediatorHelper.tabResults().getSelectedComponent()).getViewport().getView()).copy();</span>
            }
<span class="nc" id="L123">        });</span>

<span class="fc" id="L125">        JMenuItem itemSelectAll = new JMenuItem(I18nUtil.valueByKey(&quot;CONTEXT_MENU_SELECT_ALL&quot;), 'A');</span>
<span class="fc" id="L126">        I18nViewUtil.addComponentForKey(&quot;CONTEXT_MENU_SELECT_ALL&quot;, itemSelectAll);</span>
<span class="fc" id="L127">        itemSelectAll.setAccelerator(KeyStroke.getKeyStroke(KeyEvent.VK_A, InputEvent.CTRL_DOWN_MASK));</span>
<span class="fc" id="L128">        itemSelectAll.addActionListener(actionEvent -&gt; {</span>
<span class="nc bnc" id="L129" title="All 2 branches missed.">            if (MediatorHelper.tabResults().getSelectedComponent() instanceof PanelTable) {</span>
<span class="nc" id="L130">                ((PanelTable) MediatorHelper.tabResults().getSelectedComponent()).selectTable();</span>
<span class="nc bnc" id="L131" title="All 2 branches missed.">            } else if (MediatorHelper.tabResults().getSelectedComponent() instanceof JScrollPane) {</span>
                // Textarea need focus to select all
<span class="nc" id="L133">                ((JScrollPane) MediatorHelper.tabResults().getSelectedComponent()).getViewport().getView().requestFocusInWindow();</span>
<span class="nc" id="L134">                ((JTextArea) ((JScrollPane) MediatorHelper.tabResults().getSelectedComponent()).getViewport().getView()).selectAll();</span>
            }
<span class="nc" id="L136">        });</span>

<span class="fc" id="L138">        menuEdit.add(itemCopy);</span>
<span class="fc" id="L139">        menuEdit.add(new JSeparator());</span>
<span class="fc" id="L140">        menuEdit.add(itemSelectAll);</span>
<span class="fc" id="L141">        return menuEdit;</span>
    }

    private JMenu initializeMenuCommunity() {
<span class="fc" id="L145">        var menuCommunity = new JMenu(I18nUtil.valueByKey(&quot;MENUBAR_COMMUNITY&quot;));</span>
<span class="fc" id="L146">        menuCommunity.setMnemonic('C');</span>
<span class="fc" id="L147">        menuCommunity.setName(&quot;menuCommunity&quot;);</span>
<span class="fc" id="L148">        I18nViewUtil.addComponentForKey(&quot;MENUBAR_COMMUNITY&quot;, menuCommunity);</span>

<span class="fc" id="L150">        JMenu menuI18nContribution = this.initializeMenuI18nContribution();</span>
<span class="fc" id="L151">        menuI18nContribution.setName(&quot;menuI18nContribution&quot;);</span>

<span class="fc" id="L153">        JMenuItem itemReportIssue = this.initializeItemReportIssue();</span>
<span class="fc" id="L154">        itemReportIssue.setName(&quot;itemReportIssue&quot;);</span>

<span class="fc" id="L156">        menuCommunity.add(menuI18nContribution);</span>
<span class="fc" id="L157">        menuCommunity.add(new JSeparator());</span>
<span class="fc" id="L158">        menuCommunity.add(itemReportIssue);</span>
<span class="fc" id="L159">        return menuCommunity;</span>
    }

    private JMenu initializeMenuI18nContribution() {
<span class="fc" id="L163">        var menuI18nContribution = new JMenu(I18nUtil.valueByKey(&quot;MENUBAR_COMMUNITY_HELPTRANSLATE&quot;));</span>
<span class="fc" id="L164">        I18nViewUtil.addComponentForKey(&quot;MENUBAR_COMMUNITY_HELPTRANSLATE&quot;, menuI18nContribution);</span>

<span class="fc" id="L166">        final var dialogTranslate = new DialogTranslate();  // Render the About dialog behind scene</span>
<span class="fc" id="L167">        this.modelsItemInto.forEach(model -&gt; {</span>
<span class="fc" id="L168">            model.menuItem = new JMenuItem(model.language.getMenuItemLabel(), model.language.getFlag());</span>
<span class="fc" id="L169">            model.menuItem.addActionListener(new ActionTranslate(dialogTranslate, model.language));</span>
<span class="fc" id="L170">            menuI18nContribution.add(model.menuItem);</span>
<span class="fc" id="L171">        });</span>

<span class="fc" id="L173">        var itemIntoOther = new JMenuItem(I18nUtil.valueByKey(&quot;MENUBAR_COMMUNITY_ANOTHERLANGUAGE&quot;));</span>
<span class="fc" id="L174">        I18nViewUtil.addComponentForKey(&quot;MENUBAR_COMMUNITY_ANOTHERLANGUAGE&quot;, itemIntoOther);</span>

<span class="fc bfc" id="L176" title="All 2 branches covered.">        this.modelsItemInto.stream().filter(modelItem -&gt; modelItem.language == Language.AR)</span>
<span class="fc" id="L177">        .forEach(modelItem -&gt; modelItem.menuItem.setComponentOrientation(ComponentOrientation.RIGHT_TO_LEFT));</span>
<span class="fc bfc" id="L178" title="All 2 branches covered.">        this.modelsItemInto.stream().filter(modelItem -&gt; modelItem.language == Language.FR)</span>
<span class="fc" id="L179">        .forEach(modelItem -&gt; modelItem.menuItem.setName(&quot;itemIntoFrench&quot;));</span>

<span class="fc" id="L181">        menuI18nContribution.add(new JSeparator());</span>
<span class="fc" id="L182">        menuI18nContribution.add(itemIntoOther);</span>
<span class="fc" id="L183">        itemIntoOther.addActionListener(new ActionTranslate(dialogTranslate, Language.OT));</span>

<span class="fc" id="L185">        return menuI18nContribution;</span>
    }

    private JMenuItem initializeItemReportIssue() {
<span class="fc" id="L189">        JMenuItem itemReportIssue = new JMenuItem(I18nUtil.valueByKey(&quot;MENUBAR_COMMUNITY_REPORTISSUE&quot;), 'R');</span>
<span class="fc" id="L190">        I18nViewUtil.addComponentForKey(&quot;MENUBAR_COMMUNITY_REPORTISSUE&quot;, itemReportIssue);</span>

<span class="fc" id="L192">        itemReportIssue.addActionListener(actionEvent -&gt; {</span>

<span class="nc" id="L194">            var panel = new JPanel(new BorderLayout());</span>
<span class="nc" id="L195">            final JTextArea textarea = new JPopupTextArea(new JTextArea()).getProxy();</span>
<span class="nc" id="L196">            textarea.setFont(new Font(</span>
                UiUtil.FONT_NAME_MONOSPACED,
                Font.PLAIN,
<span class="nc" id="L199">                UIManager.getDefaults().getFont(&quot;TextField.font&quot;).getSize()</span>
            ));
<span class="nc" id="L201">            textarea.setText(</span>
                &quot;## What's the expected behavior?\n\n&quot;
                + &quot;## What's the actual behavior?\n\n&quot;
                + &quot;## Any other detailed information on the Issue?\n\n&quot;
                + &quot;## Steps to reproduce the problem\n\n&quot;
                + &quot;  1. ...\n&quot;
                + &quot;  2. ...\n\n&quot;
                + &quot;## [Community] Request for new feature\n\n&quot;
            );
<span class="nc" id="L210">            panel.add(new JLabel(&quot;Describe your bug or issue :&quot;), BorderLayout.NORTH);</span>
<span class="nc" id="L211">            panel.add(new JScrollPane(textarea));</span>
<span class="nc" id="L212">            panel.setPreferredSize(new Dimension(500, 350));</span>
<span class="nc" id="L213">            panel.setMinimumSize(new Dimension(500, 350));</span>

<span class="nc" id="L215">            textarea.addMouseListener(new MouseAdapter() {</span>
                @Override
                public void mousePressed(MouseEvent e) {
<span class="nc" id="L218">                    super.mousePressed(e);</span>
<span class="nc" id="L219">                    textarea.requestFocusInWindow();</span>
<span class="nc" id="L220">                }</span>
            });

<span class="nc" id="L223">            int result = JOptionPane.showOptionDialog(</span>
<span class="nc" id="L224">                MediatorHelper.frame(),</span>
                panel,
                &quot;Report an issue or a bug&quot;,
                JOptionPane.OK_CANCEL_OPTION,
                JOptionPane.QUESTION_MESSAGE,
                null,
                new String[] {
                    &quot;Report&quot;,
<span class="nc" id="L232">                    I18nUtil.valueByKey(&quot;LIST_ADD_VALUE_CANCEL&quot;)</span>
                },
<span class="nc" id="L234">                I18nUtil.valueByKey(&quot;LIST_ADD_VALUE_CANCEL&quot;)</span>
            );

<span class="nc bnc" id="L237" title="All 4 branches missed.">            if (StringUtils.isNotEmpty(textarea.getText()) &amp;&amp; result == JOptionPane.YES_OPTION) {</span>
<span class="nc" id="L238">                MediatorHelper.model().getMediatorUtils().getGitUtil().sendReport(textarea.getText(), ShowOnConsole.YES, &quot;Report&quot;);</span>
            }
<span class="nc" id="L240">        });</span>

<span class="fc" id="L242">        return itemReportIssue;</span>
    }

    private JMenu initializeMenuHelp() {
<span class="fc" id="L246">        var menuHelp = new JMenu(I18nUtil.valueByKey(&quot;MENUBAR_HELP&quot;));</span>
<span class="fc" id="L247">        menuHelp.setMnemonic('H');</span>
<span class="fc" id="L248">        I18nViewUtil.addComponentForKey(&quot;MENUBAR_HELP&quot;, menuHelp);</span>
<span class="fc" id="L249">        menuHelp.setName(&quot;menuHelp&quot;);</span>

<span class="fc" id="L251">        JMenuItem itemHelp = new JMenuItem(I18nUtil.valueByKey(&quot;MENUBAR_HELP_ABOUT&quot;), 'A');</span>
<span class="fc" id="L252">        I18nViewUtil.addComponentForKey(&quot;MENUBAR_HELP_ABOUT&quot;, itemHelp);</span>
<span class="fc" id="L253">        itemHelp.setName(&quot;itemHelp&quot;);</span>

<span class="fc" id="L255">        JMenuItem itemUpdate = new JMenuItem(I18nUtil.valueByKey(&quot;MENUBAR_HELP_UPDATE&quot;), 'U');</span>
<span class="fc" id="L256">        I18nViewUtil.addComponentForKey(&quot;MENUBAR_HELP_UPDATE&quot;, itemUpdate);</span>

        // Render the About dialog behind scene
<span class="fc" id="L259">        itemHelp.addActionListener(actionEvent -&gt; {</span>
<span class="fc" id="L260">            final var dialogAbout = new DialogAbout();</span>
<span class="pc bpc" id="L261" title="1 of 2 branches missed.">            if (!dialogAbout.isVisible()) {</span>
<span class="fc" id="L262">                dialogAbout.initializeDialog();</span>
<span class="fc" id="L263">                dialogAbout.setVisible(true);  // needed here for button focus</span>
<span class="fc" id="L264">                dialogAbout.requestButtonFocus();</span>
            }
<span class="fc" id="L266">            dialogAbout.setVisible(true);</span>
<span class="fc" id="L267">        });</span>
<span class="fc" id="L268">        itemUpdate.addActionListener(new ActionCheckUpdate());</span>

<span class="fc" id="L270">        menuHelp.add(itemUpdate);</span>
<span class="fc" id="L271">        menuHelp.add(new JSeparator());</span>
<span class="fc" id="L272">        menuHelp.add(itemHelp);</span>
<span class="fc" id="L273">        return menuHelp;</span>
    }

    public static void applyTheme(String theme) {
<span class="fc" id="L277">        UiUtil.applyTheme(theme);</span>

<span class="fc" id="L279">        Arrays.asList(</span>
            UiUtil.DATABASE_BOLD, UiUtil.ADMIN, UiUtil.DOWNLOAD, UiUtil.TERMINAL, UiUtil.UPLOAD, UiUtil.LOCK, UiUtil.TEXTFIELD, UiUtil.BATCH,
            UiUtil.TABLE_LINEAR, UiUtil.TABLE_BOLD, UiUtil.NETWORK, UiUtil.DATABASE_LINEAR, UiUtil.COG, UiUtil.CUP, UiUtil.CONSOLE, UiUtil.BINARY, UiUtil.CHUNK,
            UiUtil.ARROW, UiUtil.ARROW_HOVER, UiUtil.ARROW_PRESSED, UiUtil.EXPAND, UiUtil.EXPAND_HOVER, UiUtil.EXPAND_PRESSED,
            UiUtil.HOURGLASS, UiUtil.ARROW_DOWN, UiUtil.ARROW_UP, UiUtil.SQUARE, UiUtil.GLOBE, UiUtil.TICK_GREEN, UiUtil.CROSS_RED,
            UiUtil.REPORT, UiUtil.APP_RESULT, UiUtil.APP_ABOUT
<span class="fc" id="L285">        ).forEach(SvgIcon::setColorFilter);</span>

<span class="fc" id="L287">        SqlEngine.applyTheme();</span>
<span class="fc" id="L288">        PanelTampering.applyTheme();</span>
<span class="fc" id="L289">        MediatorHelper.panelConsoles().getTabbedPaneNetworkTab().applyTheme();</span>
<span class="fc" id="L290">        MediatorHelper.frame().revalidate();</span>

<span class="fc" id="L292">        MediatorHelper.model().getMediatorUtils().getPreferencesUtil().withThemeFlatLafName(theme).persist();</span>
<span class="fc" id="L293">    }</span>
    
    public void switchLocale(Locale newLocale) {
<span class="fc" id="L296">        this.switchLocale(I18nUtil.getLocaleDefault(), newLocale, false);</span>
<span class="fc" id="L297">    }</span>
    
    public void switchLocale(Locale oldLocale, Locale newLocale, boolean isStartup) {
<span class="fc" id="L300">        I18nUtil.setLocaleDefault(ResourceBundle.getBundle(&quot;i18n.jsql&quot;, newLocale));</span>

<span class="fc" id="L302">        Stream.of(</span>
            JTextPaneAppender.ATTRIBUTE_WARN,
            JTextPaneAppender.ATTRIBUTE_INFORM,
            JTextPaneAppender.ATTRIBUTE_SUCCESS,
            JTextPaneAppender.ATTRIBUTE_ALL
        )
<span class="fc" id="L308">        .forEach(attribute -&gt; {</span>
<span class="pc bpc" id="L309" title="1 of 2 branches missed.">            StyleConstants.setFontFamily(attribute, I18nViewUtil.isNonUbuntu(newLocale) ? UiUtil.FONT_NAME_MONO_ASIAN : UiUtil.FONT_NAME_MONO_NON_ASIAN);</span>
<span class="pc bpc" id="L310" title="1 of 2 branches missed.">            StyleConstants.setFontSize(attribute, I18nViewUtil.isNonUbuntu(newLocale) ? UiUtil.FONT_SIZE_MONO_ASIAN : UiUtil.FONT_SIZE_MONO_NON_ASIAN);</span>
<span class="fc" id="L311">        });</span>

<span class="pc bpc" id="L313" title="1 of 2 branches missed.">        MediatorHelper.managerBruteForce().getResult().setFont(I18nViewUtil.isNonUbuntu(newLocale) ? UiUtil.FONT_MONO_ASIAN : UiUtil.FONT_MONO_NON_ASIAN);</span>

<span class="fc" id="L315">        this.switchNetworkTable();</span>
<span class="fc" id="L316">        this.switchI18nComponents(newLocale);</span>
<span class="fc" id="L317">        this.switchOrientation(oldLocale, newLocale, isStartup);</span>
<span class="fc" id="L318">        this.switchMenuItems();  // required to restore proper language orientation</span>
        
<span class="fc" id="L320">        MediatorHelper.treeDatabase().reloadNodes();</span>

        // IllegalArgumentException #92981 on revalidate()
        try {
<span class="fc" id="L324">            MediatorHelper.frame().revalidate();  // Fix glitches on Linux</span>
<span class="nc" id="L325">        } catch (IllegalArgumentException e) {</span>
<span class="nc" id="L326">            LOGGER.log(LogLevelUtil.CONSOLE_JAVA, e, e);</span>
<span class="fc" id="L327">        }</span>
<span class="fc" id="L328">    }</span>

    private void switchOrientation(Locale oldLocale, Locale newLocale, boolean isStartup) {
<span class="fc" id="L331">        var componentOrientation = ComponentOrientation.getOrientation(I18nUtil.getLocaleDefault());</span>
<span class="fc" id="L332">        MediatorHelper.frame().applyComponentOrientation(componentOrientation);</span>
        
<span class="pc bpc" id="L334" title="1 of 2 branches missed.">        if (!ComponentOrientation.getOrientation(oldLocale).equals(ComponentOrientation.getOrientation(newLocale))) {</span>
            
<span class="nc" id="L336">            JSplitPane splitPaneLeftRight = MediatorHelper.frame().getSplitHorizontalTopBottom().getSplitVerticalLeftRight();</span>
<span class="nc" id="L337">            var componentLeft = splitPaneLeftRight.getLeftComponent();</span>
<span class="nc" id="L338">            var componentRight = splitPaneLeftRight.getRightComponent();</span>

            // Reset components
<span class="nc" id="L341">            splitPaneLeftRight.setLeftComponent(null);</span>
<span class="nc" id="L342">            splitPaneLeftRight.setRightComponent(null);</span>
<span class="nc" id="L343">            splitPaneLeftRight.setLeftComponent(componentRight);</span>
<span class="nc" id="L344">            splitPaneLeftRight.setRightComponent(componentLeft);</span>

<span class="nc bnc" id="L346" title="All 2 branches missed.">            if (isStartup) {</span>
                // TODO unclear and not working properly when starting as locale arabic
<span class="nc" id="L348">                splitPaneLeftRight.setDividerLocation(</span>
<span class="nc" id="L349">                    splitPaneLeftRight.getDividerLocation()</span>
                );
            } else {  // required as switch to arabic uses reversed location
<span class="nc" id="L352">                splitPaneLeftRight.setDividerLocation(</span>
<span class="nc" id="L353">                    splitPaneLeftRight.getWidth() -</span>
<span class="nc" id="L354">                    splitPaneLeftRight.getDividerLocation()</span>
                );
            }
        }
        
<span class="fc" id="L359">        MediatorHelper.tabResults().setComponentOrientation(ComponentOrientation.getOrientation(newLocale));</span>
<span class="fc" id="L360">    }</span>

    private void switchI18nComponents(Locale newLocale) {
<span class="fc bfc" id="L363" title="All 2 branches covered.">        for (String key: I18nViewUtil.keys()) {</span>
<span class="fc" id="L364">            String textI18n = I18nViewUtil.valueByKey(key, newLocale);</span>
<span class="fc bfc" id="L365" title="All 2 branches covered.">            for (Object componentSwing: I18nViewUtil.componentsByKey(key)) {  // instanceof as no common parent with setText()</span>
<span class="fc bfc" id="L366" title="All 2 branches covered.">                if (componentSwing instanceof JTextFieldPlaceholder) {</span>
                    // Textfield does not need &lt;html&gt; tags for asian fonts
<span class="fc" id="L368">                    ((JTextFieldPlaceholder) componentSwing).setPlaceholderText(I18nUtil.valueByKey(key));</span>
<span class="fc bfc" id="L369" title="All 2 branches covered.">                } else if (componentSwing instanceof JToolTipI18n) {</span>
<span class="fc" id="L370">                    ((JToolTipI18n) componentSwing).setText(textI18n);</span>
<span class="fc bfc" id="L371" title="All 2 branches covered.">                } else if (componentSwing instanceof JLabel) {</span>
<span class="fc" id="L372">                    ((JLabel) componentSwing).setText(textI18n);</span>
<span class="fc bfc" id="L373" title="All 2 branches covered.">                } else if (componentSwing instanceof JCheckBoxMenuItem) {</span>
<span class="fc" id="L374">                    ((JCheckBoxMenuItem) componentSwing).setText(textI18n);</span>
<span class="fc bfc" id="L375" title="All 2 branches covered.">                } else if (componentSwing instanceof JMenuItem) {</span>
<span class="fc" id="L376">                    ((JMenuItem) componentSwing).setText(textI18n);</span>
<span class="fc bfc" id="L377" title="All 2 branches covered.">                } else if (componentSwing instanceof JButtonStateful) {</span>
<span class="fc" id="L378">                    ((JButtonStateful) componentSwing).setText(textI18n);</span>
<span class="pc bpc" id="L379" title="1 of 2 branches missed.">                } else if (componentSwing instanceof NodeModelEmpty) {</span>
<span class="fc" id="L380">                    ((NodeModelEmpty) componentSwing).setText(textI18n);</span>
                } else {
<span class="nc" id="L382">                    ((JTextComponent) componentSwing).setText(textI18n);</span>
                }
<span class="fc" id="L384">            }</span>
<span class="fc" id="L385">        }</span>
<span class="fc" id="L386">    }</span>

    private void switchMenuItems() {
<span class="fc" id="L389">        Stream.concat(this.modelsItem.stream(), this.modelsItemInto.stream())</span>
<span class="fc" id="L390">        .forEach(modelItemInto -&gt; modelItemInto.menuItem.setComponentOrientation(</span>
<span class="fc bfc" id="L391" title="All 2 branches covered.">            modelItemInto.language.isRightToLeft()</span>
<span class="fc" id="L392">            ? ComponentOrientation.RIGHT_TO_LEFT</span>
<span class="fc" id="L393">            : ComponentOrientation.LEFT_TO_RIGHT</span>
        ));
<span class="fc" id="L395">    }</span>

    private void switchNetworkTable() {
<span class="fc" id="L398">        JTableHeader header = MediatorHelper.panelConsoles().getNetworkTable().getTableHeader();</span>
<span class="fc" id="L399">        TableColumnModel columnModel = header.getColumnModel();</span>
<span class="fc" id="L400">        columnModel.getColumn(0).setHeaderValue(I18nUtil.valueByKey(&quot;NETWORK_TAB_URL_COLUMN&quot;));</span>
<span class="fc" id="L401">        columnModel.getColumn(1).setHeaderValue(I18nUtil.valueByKey(&quot;NETWORK_TAB_SIZE_COLUMN&quot;) +&quot; (KB)&quot;);</span>
<span class="fc" id="L402">        columnModel.getColumn(2).setHeaderValue(I18nUtil.valueByKey(&quot;SQLENGINE_STRATEGY&quot;));</span>
<span class="fc" id="L403">        columnModel.getColumn(3).setHeaderValue(I18nUtil.valueByKey(&quot;SQLENGINE_METADATA&quot;));</span>
<span class="fc" id="L404">        header.repaint();</span>
<span class="fc" id="L405">    }</span>
    
    
    // Getter and setter

    public JMenu getMenuView() {
<span class="nc" id="L411">        return this.menuWindows.getMenuView();</span>
    }

    public MenuWindows getMenuWindows() {
<span class="fc" id="L415">        return this.menuWindows;</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.12.202403310830</span></div></body></html>