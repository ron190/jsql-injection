<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang=""><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>AbstractColoredConsole.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">view</a> &gt; <a href="index.source.html" class="el_package">com.jsql.view.swing.console</a> &gt; <span class="el_source">AbstractColoredConsole.java</span></div><h1>AbstractColoredConsole.java</h1><pre class="source lang-java linenums">package com.jsql.view.swing.console;

import com.jsql.util.LogLevelUtil;
import com.jsql.view.swing.text.JPopupTextPane;
import com.jsql.view.swing.util.MediatorHelper;
import org.apache.commons.lang3.StringUtils;
import org.apache.logging.log4j.LogManager;
import org.apache.logging.log4j.Logger;

import javax.swing.*;
import javax.swing.text.SimpleAttributeSet;
import java.awt.*;
import java.awt.event.FocusAdapter;
import java.awt.event.FocusEvent;

/**
 * A JTextPane which displays colored strings.
 */
public abstract class AbstractColoredConsole extends JPopupTextPane {
    
    /**
     * Log4j logger sent to view.
     */
<span class="fc" id="L24">    private static final Logger LOGGER = LogManager.getRootLogger();</span>

    /**
     * Text name of tab.
     */
    private final String tabName;

    /**
     * Create a JTextPane which displays colored strings.
     * @param tabName Text name of tab
     */
    protected AbstractColoredConsole(final String tabName, String placeholder) {
<span class="fc" id="L36">        super(placeholder);</span>
<span class="fc" id="L37">        this.tabName = tabName;</span>
<span class="fc" id="L38">        this.addFocusListener(new FocusAdapter() {</span>
            @Override
            public void focusGained(FocusEvent focusEvent) {
<span class="nc" id="L41">                AbstractColoredConsole.this.getProxy().getCaret().setVisible(true);</span>
<span class="nc" id="L42">                AbstractColoredConsole.this.getProxy().getCaret().setSelectionVisible(true);</span>
<span class="nc" id="L43">            }</span>
        });
<span class="fc" id="L45">        this.setCursor(Cursor.getPredefinedCursor(Cursor.TEXT_CURSOR));</span>
<span class="fc" id="L46">    }</span>
    
    protected abstract SimpleAttributeSet getColorAttribute();

    /**
     * Add a string to the end of JTextPane.
     * @param message Text to add
     * @param attribut Font
     */
    public void append(String message, SimpleAttributeSet attribut) {
        try {
<span class="pc bpc" id="L57" title="1 of 2 branches missed.">            boolean isCaretAtEnd = this.getProxy().getCaretPosition() == this.getProxy().getDocument().getLength();</span>
            
<span class="fc" id="L59">            JScrollPane scrollPane = (JScrollPane) this.getProxy().getParent().getParent();</span>
<span class="fc" id="L60">            JScrollBar scrollBar = scrollPane.getVerticalScrollBar();</span>
<span class="fc" id="L61">            int extent = scrollBar.getModel().getExtent();</span>
<span class="pc bpc" id="L62" title="1 of 2 branches missed.">            boolean isScrollBarAtEnd = scrollBar.getValue() &gt;= scrollBar.getMaximum() - extent;</span>
            
<span class="fc" id="L64">            var logMessage = message.substring(15);</span>
<span class="fc" id="L65">            var logTimestamp = message.substring(0, 15);</span>
            
<span class="fc" id="L67">            this.getProxy().getDocument().insertString(</span>
<span class="fc" id="L68">                this.getProxy().getDocument().getLength(),</span>
<span class="fc bfc" id="L69" title="All 2 branches covered.">                (this.getProxy().getDocument().getLength() == 0 ? StringUtils.EMPTY : &quot;\n&quot;) + logTimestamp,</span>
<span class="fc" id="L70">                this.getColorAttribute()</span>
            );
            
<span class="fc" id="L73">            this.getProxy().getDocument().insertString(</span>
<span class="fc" id="L74">                this.getProxy().getDocument().getLength(),</span>
                logMessage,
                attribut
            );
            
<span class="pc bpc" id="L79" title="3 of 4 branches missed.">            if (isCaretAtEnd || isScrollBarAtEnd) {</span>
<span class="fc" id="L80">                scrollBar.setValue(scrollBar.getMaximum() + 1);</span>
            }

<span class="fc" id="L83">            var foregroundColor = UIManager.getColor(&quot;TextArea.foreground&quot;);</span>
<span class="fc bfc" id="L84" title="All 2 branches covered.">            if (attribut == JTextPaneAppender.ATTRIBUTE_WARN) {</span>
<span class="fc" id="L85">                foregroundColor = LogLevelUtil.COLOR_RED;</span>
<span class="pc bpc" id="L86" title="1 of 2 branches missed.">            } else if (attribut == JTextPaneAppender.ATTRIBUTE_SUCCESS) {</span>
<span class="nc" id="L87">                foregroundColor = LogLevelUtil.COLOR_GREEN;</span>
            }
            
<span class="fc" id="L90">            int tabIndex = MediatorHelper.tabConsoles().indexOfTab(this.tabName);</span>
<span class="pc bpc" id="L91" title="2 of 4 branches missed.">            if (0 &lt;= tabIndex &amp;&amp; tabIndex &lt; MediatorHelper.tabConsoles().getTabCount()) {</span>
<span class="fc" id="L92">                var tabHeader = MediatorHelper.tabConsoles().getTabComponentAt(tabIndex);</span>
<span class="fc bfc" id="L93" title="All 2 branches covered.">                if (MediatorHelper.tabConsoles().getSelectedIndex() != tabIndex) {</span>
<span class="fc" id="L94">                    tabHeader.setFont(tabHeader.getFont().deriveFont(Font.BOLD));</span>
<span class="pc bpc" id="L95" title="1 of 2 branches missed.">                    if (foregroundColor != UIManager.getColor(&quot;TextArea.foreground&quot;)) {  // keep tab colored until user clicks</span>
<span class="fc" id="L96">                        tabHeader.setForeground(foregroundColor);</span>
                    }
                }
            }
<span class="fc" id="L100">        } catch (Exception e) {</span>
            // Report #863: exception during report of exception
<span class="fc" id="L102">            LOGGER.log(LogLevelUtil.CONSOLE_JAVA, message, e);</span>
<span class="fc" id="L103">        }</span>
<span class="fc" id="L104">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.12.202403310830</span></div></body></html>