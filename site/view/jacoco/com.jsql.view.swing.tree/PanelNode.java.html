<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang=""><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>PanelNode.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">view</a> &gt; <a href="index.source.html" class="el_package">com.jsql.view.swing.tree</a> &gt; <span class="el_source">PanelNode.java</span></div><h1>PanelNode.java</h1><pre class="source lang-java linenums">/*******************************************************************************
 * Copyhacked (H) 2012-2025.
 * This program and the accompanying materials
 * are made available under no term at all, use it like
 * you want, but share and discuss it
 * every time possible with every body.
 *
 * Contributors:
 *      ron190 at ymail dot com - initial implementation
 ******************************************************************************/
package com.jsql.view.swing.tree;

import com.jsql.util.I18nUtil;
import com.jsql.view.swing.tree.model.AbstractNodeModel;
import com.jsql.view.swing.util.UiStringUtil;
import com.jsql.view.swing.util.UiUtil;

import javax.swing.*;
import javax.swing.tree.DefaultMutableTreeNode;
import java.awt.*;
import java.awt.event.FocusAdapter;
import java.awt.event.FocusEvent;
import java.awt.event.KeyAdapter;
import java.awt.event.KeyEvent;
import java.nio.charset.StandardCharsets;
import java.util.stream.Stream;

/**
 * A tree Node composed of an icon, a GIF loader, a progress bar, a label.
 */
public class PanelNode extends JPanel {
    
    /**
     * Default icon of the node (database or table).
     */
<span class="fc" id="L36">    private final JLabel iconNode = new JLabel();</span>

    /**
     * A GIF loader, displayed if progress track is unknown (like columns).
     */
<span class="fc" id="L41">    private final JLabel loaderWait = new JLabel();</span>

    /**
     * Progress bar displayed during injection, with pause icon displayed if user paused the process.
     */
<span class="fc" id="L46">    private final ProgressBarPausable progressBar = new ProgressBarPausable();</span>

    /**
     * Text of the node.
     */
<span class="fc" id="L51">    private final JLabel nodeLabel = new JLabel();</span>
<span class="fc" id="L52">    private final JTextField textFieldEditable = new JTextField(15);</span>
    
    /**
     * Create Panel for tree nodes.
     * @param tree JTree to populate
     * @param currentNode Node to draw in the tree
     */
<span class="fc" id="L59">    public PanelNode(final JTree tree, final DefaultMutableTreeNode currentNode) {</span>
<span class="fc" id="L60">        this.loaderWait.setIcon(UiUtil.HOURGLASS.icon);</span>
<span class="fc" id="L61">        this.loaderWait.setBorder(BorderFactory.createEmptyBorder(2, 2, 2, 2));</span>

<span class="fc" id="L63">        this.progressBar.setPreferredSize(new Dimension(20, 20));</span>
<span class="fc" id="L64">        this.progressBar.setBorder(BorderFactory.createEmptyBorder(4, 3, 4, 3));</span>

<span class="fc" id="L66">        this.nodeLabel.setOpaque(true);</span>

<span class="fc" id="L68">        this.iconNode.setBorder(BorderFactory.createEmptyBorder(2, 2, 2, 2));</span>
        
<span class="fc" id="L70">        this.setLayout(new BoxLayout(this, BoxLayout.LINE_AXIS));</span>
        
<span class="fc" id="L72">        Stream.of(</span>
            this.iconNode,
            this.loaderWait,
            this.progressBar,
            this.nodeLabel,
            this.textFieldEditable
        )
<span class="fc" id="L79">        .forEach(component -&gt; {</span>
<span class="fc" id="L80">            this.add(component);</span>
<span class="fc" id="L81">            component.setVisible(false);</span>
<span class="fc" id="L82">        });</span>
        
<span class="fc" id="L84">        this.setComponentOrientation(ComponentOrientation.getOrientation(I18nUtil.getLocaleDefault()));</span>
        
<span class="fc" id="L86">        this.initializeTextFieldEditable(tree, currentNode);</span>
<span class="fc" id="L87">    }</span>

    private void initializeTextFieldEditable(final JTree tree, final DefaultMutableTreeNode currentNode) {
<span class="fc" id="L90">        this.textFieldEditable.addActionListener(e -&gt; {</span>
<span class="nc" id="L91">            AbstractNodeModel nodeModel = (AbstractNodeModel) currentNode.getUserObject();</span>
<span class="nc" id="L92">            nodeModel.setIsEdited(false);</span>
            
<span class="nc" id="L94">            this.nodeLabel.setVisible(true);</span>
<span class="nc" id="L95">            this.textFieldEditable.setVisible(false);</span>
<span class="nc" id="L96">            tree.requestFocusInWindow();</span>

<span class="nc" id="L98">            nodeModel.getElementDatabase().setElementValue(new String(</span>
<span class="nc" id="L99">                this.textFieldEditable.getText().getBytes(StandardCharsets.UTF_8),</span>
                StandardCharsets.UTF_8
            ));
<span class="nc" id="L102">            this.nodeLabel.setText(UiStringUtil.detectUtf8Html(nodeModel.getElementDatabase().getLabelWithCount()));</span>
            
<span class="nc" id="L104">            tree.revalidate();</span>
<span class="nc" id="L105">            tree.repaint();</span>
<span class="nc" id="L106">        });</span>
        
<span class="fc" id="L108">        this.textFieldEditable.addFocusListener(new FocusAdapter() {</span>
            @Override
            public void focusLost(FocusEvent e) {
<span class="nc" id="L111">                AbstractNodeModel nodeModel = (AbstractNodeModel) currentNode.getUserObject();</span>
<span class="nc" id="L112">                nodeModel.setIsEdited(false);</span>
<span class="nc" id="L113">                tree.revalidate();</span>
<span class="nc" id="L114">                tree.repaint();</span>
<span class="nc" id="L115">            }</span>
        });
        
<span class="fc" id="L118">        KeyAdapter keyAdapterF2 = new KeyAdapter() {</span>
            @Override
            public void keyPressed(KeyEvent e) {
<span class="nc" id="L121">                AbstractNodeModel nodeModel = (AbstractNodeModel) currentNode.getUserObject();</span>
                
<span class="nc bnc" id="L123" title="All 4 branches missed.">                if (e.getKeyCode() == KeyEvent.VK_F2 &amp;&amp; !nodeModel.isRunning()) {</span>
<span class="nc" id="L124">                    nodeModel.setIsEdited(true);</span>
                    
<span class="nc" id="L126">                    PanelNode.this.nodeLabel.setVisible(false);</span>
<span class="nc" id="L127">                    PanelNode.this.textFieldEditable.setVisible(true);</span>
<span class="nc" id="L128">                    PanelNode.this.textFieldEditable.requestFocusInWindow();</span>
                    
<span class="nc" id="L130">                    tree.revalidate();</span>
<span class="nc" id="L131">                    tree.repaint();</span>
                }
<span class="nc" id="L133">            }</span>
        };
        
<span class="fc" id="L136">        this.addKeyListener(keyAdapterF2);</span>
<span class="fc" id="L137">        this.textFieldEditable.addKeyListener(keyAdapterF2);</span>
<span class="fc" id="L138">    }</span>

    /**
     * Change the text icon.
     * @param newIcon An icon to display next to the text.
     */
    public void setIconNode(Icon newIcon) {
<span class="fc" id="L145">        this.iconNode.setIcon(newIcon);</span>
<span class="fc" id="L146">    }</span>
    
    /**
     * Display the normal text icon to the left.
     */
    public void showIcon() {
<span class="fc" id="L152">        this.iconNode.setVisible(true);</span>
<span class="fc" id="L153">    }</span>
    
    /**
     * Mask the node icon for example when the loader component is displayed.
     */
    public void hideIcon() {
<span class="nc" id="L159">        this.iconNode.setVisible(false);</span>
<span class="nc" id="L160">    }</span>
    
    /**
     * Change the loader icon.
     * @param newIcon An icon to display for the loader.
     */
    public void setLoaderIcon(Icon newIcon) {
<span class="nc" id="L167">        this.loaderWait.setIcon(newIcon);</span>
<span class="nc" id="L168">    }</span>

    /**
     * Display the animated gif loader.
     */
    public void showLoader() {
<span class="nc" id="L174">        this.loaderWait.setVisible(true);</span>
<span class="nc" id="L175">    }</span>
    
    
    // Getter and setter

    public ProgressBarPausable getProgressBar() {
<span class="nc" id="L181">        return this.progressBar;</span>
    }

    public JLabel getNodeLabel() {
<span class="fc" id="L185">        return this.nodeLabel;</span>
    }

    public JTextField getTextFieldEditable() {
<span class="fc" id="L189">        return this.textFieldEditable;</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.12.202403310830</span></div></body></html>